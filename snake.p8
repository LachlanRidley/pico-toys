pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
function _init()
 snake={
 	{x=5,y=4},--head
 	{x=4,y=4},
 	{x=3,y=4} --tail
 }
 dir="➡️"
 next_dir="➡️"
 snake_speed=15
 snake_tick=snake_speed
 food_x=6
 food_y=6
end

function _update()
	if btn(⬇️) then next_dir="⬇️" end
	if btn(⬆️) then next_dir="⬆️" end
	if btn(➡️) then next_dir="➡️" end
	if btn(⬅️) then next_dir="⬅️" end
	
	if snake_tick <= 0 then
		dir=next_dir
		new_p={x=snake[1].x,y=snake[1].y}
		if dir=="⬇️" then new_p.y+=1 end
		if dir=="⬆️" then new_p.y-=1 end
		if dir=="⬅️" then new_p.x-=1 end
		if dir=="➡️" then new_p.x+=1 end
		
		for i=#snake,1,-1 do
		 snake[i+1]=snake[i]
		end
		deli(snake,#snake)
		snake[1]=new_p
		
		snake_tick=snake_speed
		
		if snake[1].x==food_x and snake[1].y==food_y then
			local	snake_tail={x=snake[#snake].x,y=snake[#snake].y}
			add(snake,snake_tail)
		 food_x=flr(rnd(16))
		 food_y=flr(rnd(16))
		end
	else
		snake_tick-=1
	end
end

function _draw()
	cls()
	map()

	local i=1
	for p in all(snake) do
		local x=p.x*8
		local y=p.y*8
		if i==1 then
			draw_head(x,y,dir)
		elseif i==#snake then
			if is_above(snake[i], snake[i-1]) then
				spr(6,x,y,1,1)
			elseif is_left(snake[i], snake[i-1]) then
				spr(5,x,y,1,1,true)
			elseif is_right(snake[i], snake[i-1]) then
				spr(5,x,y,1,1)
			else
				spr(6,x,y,1,1,false,true)
			end
		else
			draw_segment(x,y,i)
		end
		i+=1
	end

	circfill(food_x*8+4,food_y*8+4,2.5,10)
end

function draw_segment(x,y,s)
	local prev=snake[s-1]
	local seg=snake[s]
	local nxt=snake[s+1]

	if prev.y==seg.y and nxt.y==seg.y then
 	--vertical
 	spr(4,x,y)
	elseif prev.x==seg.x and nxt.x==seg.x then
 	--horizontal
 	spr(3,x,y)
	else
	 --todo corners
		local flip_x=false
		local flip_y=false

		if is_above(seg,prev) or is_above(seg,nxt) then
			flip_y=true
		end

		if is_left(seg,prev) or is_left(seg,nxt) then
			flip_x=true
		end

	 spr(7,x,y,1,1,flip_x,flip_y)
	end
end

function is_above(seg, other)
	return seg.x==other.x and other.y<seg.y
end

function is_below(seg, other)
	return seg.x==other.x and other.y>seg.y
end

function is_left(seg, other)
	return seg.y==other.y and other.x<seg.x
end

function is_right(seg, other)
	return seg.y==other.y and other.x>seg.x
end

function draw_head(x,y,dir)
	if dir=="⬆️" then spr(2,x,y,1,1,false,true) end
	if dir=="⬇️" then spr(2,x,y) end
	if dir=="⬅️" then spr(1,x,y,1,1,true) end
	if dir=="➡️" then spr(1,x,y) end
end
__gfx__
0000000000bbbb000b3333b00b3333b000bbbb00000000000b3333b0000000008000000800000000000000000000000000000000000000000000000000000000
00000000bb3333b00b3333b00b3333b0bb3333bb000bbbbb0b3333b0000bbbbb0800008000000000000000000000000000000000000000000000000000000000
007007003333313bb333333bb333333b333333330bb333330b3333b000b333330080080000000000000000000000000000000000000000000000000000000000
000770003333333bb333333bb333333b33333333b33333330b3333b00b3333330008800000000000000000000000000000000000000000000000000000000000
000770003333333bb333333bb333333b33333333b33333330b3333b00b3333330008800000000000000000000000000000000000000000000000000000000000
007007003333313bb313313bb333333b333333330bb3333300b33b000b3333330080080000000000000000000000000000000000000000000000000000000000
00000000bb3333b00b3333b00b3333b0bb3333bb000bbbbb00b33b000b33333b0800008000000000000000000000000000000000000000000000000000000000
0000000000bbbb0000bbbb000b3333b000bbbb0000000000000bb0000b3333bb8000000800000000000000000000000000000000000000000000000000000000
ffffff9f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ffffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
f9ffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ffff9fff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ffffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ffffff9f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ff9fffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ffffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0210101010101010101010101010100200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0210101010101010101010101010100100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
